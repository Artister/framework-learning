# 线程安全策略

## 不可变对象需要满足的条件

- 对象创建以后其状态就不能修改
- 对象所有域都是final类型
- 对象是正确创建的（在对象创建期间，this引用没有逸出）

## final关键字：类，方法，变量

- 修饰类：不能被继承
- 修饰方法
  - 锁定方法不被继承类修改
  - 效率，类比较重时候感知为0
  - private方法会隐式指定为final
- 修饰变量：基本数据类型变量，引用类型变量

## 其他不可变对象的方法

- Collections.unmodifiableXXX: Collection, List, Set, Map...
- Guava: ImmutableXXX: Collection, List, Set, Map...

## 线程封闭

- Ad-hoc线程封闭：程序控制实现，最糟糕，忽略
- 堆栈封闭：局部变量，无并发问题
- ThreadLocal线程封闭：特别好的封闭方法（数据库连接的conn对象，使用线程封闭最好的方法）

## 线程不安全类与写法

- StringBuffer -> StringBuilder
- SimpleDataFormat -> JodaTime
- ArrayList, HashSet, HashMap等Collections
- **先检查再执行：if(condition(a)) { handle(a); }**

## 线程安全 - 同步容器

- ArrayList -> Vector, Stack
- HashMap -> HashTable(key, value不能为null)
- Collections.synchronizedXXX(List, Set, Map)

> @See ---> 6-7 同步容器2